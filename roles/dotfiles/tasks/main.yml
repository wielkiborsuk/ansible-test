---
- name: Install stow
  apt: name=stow state=latest

- name: Ensure the .ssh, workspace, etc. directories exists
  become: no
  file: path={{item.path}} state=directory
  with_items:
    - { path: '~/.ssh' }
    - { path: '~/workspace' }
    - { path: '~/workspace/tools' }
    - { path: '~/.fonts' }
    - { path: '~/bin' }

- name: Ensure the default directories do not exist
  become: no
  file: path={{item.path}} state=absent
  with_items:
    - { path: '~/Desktop' }
    - { path: '~/Documents' }
    - { path: '~/Music' }
    - { path: '~/Pictures' }
    - { path: '~/Public' }
    - { path: '~/Templates' }
    - { path: '~/Videos' }

- name: Add ssh config with your keys to access all repositories
  become: no
  copy: src={{item.src}} dest=~/.ssh/ mode=0600
  with_items:
    - { src: '~/.ssh/id_rsa.pub'}
    - { src: '~/.ssh/id_rsa'}

- name: Grab dotfiles git repo - this is a crucial step will be required by others
  become: no
  git:
    repo: "git@bitbucket.com:wielkiborsuk/dotfiles.git"
    dest: "~/.dotfiles"
    accept_hostkey: yes
    update: yes
    force: yes

- name: remove .gitconfig to allow git stowing
  become: no
  file:
    path: '~/.gitconfig'
    state: absent

- name: remove .Xdefaults to allow rxvt stowing
  become: no
  file:
    path: '~/.Xdefaults'
    state: absent

- name: link config files
  become: no
  shell: stow -R {{ item }}
  args:
    chdir: ~/.dotfiles
  with_items:
    - stow
    - dunst
    - git
    - i3
    - ranger
    - rxvt
    - vundle-vim
    - zsh
    - cmus
    - smalls
    - weechat

- name: enable bitmap fonts
  file: path=/etc/fonts/conf.d/70-no-bitmaps.conf state=absent

- name: Grab smalls git repo - contains commands used by desktop setup
  become: no
  git:
    repo: "git@bitbucket.com:wielkiborsuk/smalls.git"
    dest: "~/workspace/smalls"
    accept_hostkey: yes
    update: yes

- name: link commands from smalls
  become: no
  shell: stow -R -t ~/ {{ item }}
  args:
    chdir: ~/workspace/smalls
  with_items:
    - album_converter
    - gmailcheck
    - pomodoro
    - cmus_resume

- name: Grab player_control git repo - a multimedia player control script
  become: no
  git:
    repo: "git@github.com:wielkiborsuk/player_control.git"
    dest: "~/workspace/tools/player_control"
    accept_hostkey: yes
    update: yes

- name: link player_control as command
  become: no
  file:
    src: "~/workspace/tools/player_control/__main__.py"
    dest: "~/bin/player_control"
    state: link

      #append to the end of sudoers file
#ALL ALL=(root) NOPASSWD: /sbin/poweroff
#ALL ALL=(root) NOPASSWD: /sbin/reboot

